#define WIN32_LEAN_AND_MEAN

#include <windows.h>
#include <stdio.h>
#include "main.h"


// Need to link with Ws2_32.lib, Mswsock.lib, and Advapi32.lib
#pragma comment (lib, "Ws2_32.lib")
#pragma comment (lib, "Mswsock.lib")
#pragma comment (lib, "AdvApi32.lib")

using namespace std;

void ClearWinSock() {
	WSACleanup();
}

int main() {
	WSADATA wsaData;
	SOCKET socketC = INVALID_SOCKET;
	struct addrinfo* result = NULL, * ptr = NULL, hints;
	Command command;

	// Initialize Winsock
	WSAStartup(MAKEWORD(2, 2), &wsaData);

	ZeroMemory(&hints, sizeof(hints));
	hints.ai_family = AF_UNSPEC;
	hints.ai_socktype = SOCK_STREAM;
	hints.ai_protocol = IPPROTO_TCP;

	// Resolve the server address and port
	getaddrinfo("192.168.5.59", "2222", &hints, &result);

	// Create a SOCKET for connecting to server
	socketC = socket(result->ai_family, result->ai_socktype, result->ai_protocol);

	// Connect to server.
	int status = -1;
	while (status!=0){
		status = connect(socketC, result->ai_addr, (int)result->ai_addrlen);
		cout << "status: " << status << endl;

	}
	OperateSocket operateSocket(socketC);
	while(true){
		operateSocket.operate();
	}

	// Closing connection
	freeaddrinfo(result);
	closesocket(socketC);
	ClearWinSock();
	system("pause");
	return 0;
}